import{k as x,P as d,K as m,A as y,e as g,f as r,L as T,E as p,G as h,t as D,h as f,i as k,w,D as _,c as u,g as b,M as S}from"./LFDqsYmP.js";import{u as L}from"./_6tQ4GU3.js";import{u as N}from"./DB-cw25v.js";class l extends Error{}l.prototype.name="InvalidTokenError";function U(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,o)=>{let n=o.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function E(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(e)}catch{return atob(e)}}function I(s,e){if(typeof s!="string")throw new l("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,n=s.split(".")[o];if(typeof n!="string")throw new l(`Invalid token specified: missing part #${o+1}`);let t;try{t=E(n)}catch(i){throw new l(`Invalid token specified: invalid base64 for part #${o+1} (${i.message})`)}try{return JSON.parse(t)}catch(i){throw new l(`Invalid token specified: invalid json for part #${o+1} (${i.message})`)}}const V={layout:"empty",data(){return{username:"",password:"",inLoad:!1,message:"",isVerified:!1,target:(this._.provides[d]||this.$route).query.target||"/"}},setup(){const s=L(),e=m("isUserAuth"),o=m("uid");return{cookies:s,isUserAuth:e,uid:o}},mounted(){(this._.provides[d]||this.$route).query.message&&(this.message=(this._.provides[d]||this.$route).query.message)},methods:{async login(){this.inLoad=!0;const s={username:this.username,password:this.password};try{const e=await $fetch("/api/auth/login",{method:"POST",body:s,credentials:"include"});if(this.inLoad=!1,e.status===200){const o=e.data;console.log("Đăng nhập thành công!"),this.cookies.set("accessToken",o.accessToken,{path:"/",expires:new Date(new Date().getTime()+60*60*1e3)}),this.cookies.set("refreshToken",o.refreshToken,{path:"/",expires:new Date(new Date().getTime()+60*60*1e3*24*7)});const n=this.cookies.get("accessToken"),t=I(n),i={id:t.id,uid:t.uid,username:t.username,firstName:t.firstName,lastName:t.lastName,nickname:t.nickname,avatar:t.avatar,elo:t.elo,trainingStatus:t.trainingStatus};if(this.uid.value=i.uid,this.isUserAuth.value=!0,this.userStorage.value=i,!n||!this.cookies.get("refreshToken"))throw new Error("Lỗi đăng nhập, không nhận được token!");this.isVerified=!0,this.$emit("login-success",this.username),console.log("Đăng nhập thành công và token đã được lưu trong cookies"),this.$router.push(this.target)}else throw new Error(e.message)}catch(e){this.message=e.message,console.error(e)}},async loginDemo(){if(this.username="demo",this.password="demo",await this.login(),this.username!=="false"&&this.$router.push(this.target||"/"),this.username==="false")this.message="Demo login failed!";else{const s={username:"demo",name:"Demo user",avatar:"https://res.cloudinary.com/drgzcrye6/image/upload/v1732819880/obhw6bw9twmkqvlng21y.jpg"};this.cookies.set("accessToken","accessToken",{path:"/",expires:new Date(new Date().getTime()+60*60*1e3)}),N("user",s,localStorage)}}}},C={id:"authorized",class:"w-full flex h-screen bg-indigo-700"},$={class:"w-full max-w-xs m-auto bg-indigo-100 rounded p-5"},q={class:"form-group"},A={class:"form-group"},j={key:0,class:"message"};function B(s,e,o,n,t,i){const c=y("RouterLink"),v=S;return u(),g("div",C,[r("div",$,[e[8]||(e[8]=r("header",null,[r("h2",{class:"text-bold text-indigo-700 font-bold text-2xl text-center mb-4"}," Đăng nhập ")],-1)),r("form",{onSubmit:e[2]||(e[2]=T((...a)=>i.loginDemo&&i.loginDemo(...a),["prevent"]))},[r("div",q,[e[3]||(e[3]=r("label",{class:"block mb-2 text-black",for:"username"},"Tên tài khoản",-1)),p(r("input",{type:"text",class:"form-control w-full p-2 mb-6 text-indigo-700 border-b-2 border-indigo-500 outline-none focus:bg-gray-300",id:"username","onUpdate:modelValue":e[0]||(e[0]=a=>t.username=a),required:""},null,512),[[h,t.username]])]),r("div",A,[e[4]||(e[4]=r("label",{class:"block mb-2 text-black",for:"password"},"Mật khẩu",-1)),p(r("input",{type:"password",class:"form-control w-full p-2 mb-6 text-indigo-700 border-b-2 border-indigo-500 outline-none focus:bg-gray-300",id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>t.password=a),required:""},null,512),[[h,t.password]])]),t.message?(u(),g("div",j,D(t.message),1)):f("",!0),e[5]||(e[5]=r("button",{type:"submit",class:"w-full bg-indigo-700 hover:bg-pink-700 text-white font-bold py-2 px-4 mb-6 rounded"}," Đăng nhập ",-1))],32),r("footer",null,[k(c,{to:"forgot-pass",class:"text-indigo-700 hover:text-pink-700 text-sm float-left"},{default:w(()=>e[6]||(e[6]=[b(" Quên mật khẩu? ")])),_:1}),k(c,{to:"signup",class:"text-indigo-700 hover:text-pink-700 text-sm float-right"},{default:w(()=>e[7]||(e[7]=[b(" Đăng ký ")])),_:1})])]),t.inLoad?(u(),_(v,{key:0})):f("",!0)])}const z=x(V,[["render",B],["__scopeId","data-v-79b96224"]]);export{z as default};
