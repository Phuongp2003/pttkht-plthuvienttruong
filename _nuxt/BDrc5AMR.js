import{k as p,c as d,e as c,f as s,t as u,n as b,F as w,C as k,g as _,h as g,G as f,i as v,H as D}from"./DvdhT6td.js";import{_ as y}from"./CP6rAmcq.js";import{u as B}from"./DPHYbopj.js";import"./Cpj98o6Y.js";const I={props:{user:{type:Object,required:!0}},data(){return{showBooks:!1}},computed:{statusClass(){const o=new Date().toISOString().split("T")[0],t=this.user.borrowedBooks.some(n=>n.returnDate<o&&n.status==="IB"),i=this.user.borrowedBooks.some(n=>n.returnDate>=o&&n.status==="IB");return t?"bg-red-500":i?"bg-yellow-500":"bg-green-500"}},methods:{toggleBooks(){this.showBooks=!this.showBooks},confirmReturned(o){this.$emit("confirm-returned",o)},confirmAllReturned(){this.$emit("confirm-all-returned",this.user.id)}}},C={class:"p-4 bg-white rounded shadow user-info"},S={class:"flex-grow"},T={class:"text-lg font-semibold"},U={class:"text-gray-700"},j={key:0,class:"mt-4"},F={class:"flex items-center gap-3"},N=["src","alt"],O={class:"flex-grow"},H={class:"font-semibold text-md"},R={class:"text-gray-700"},A={class:"text-gray-700"},V={class:"text-gray-700"},E={class:"text-gray-700"},L={key:0},X=["onClick"],$={class:"mt-4"};function q(o,t,i,n,l,a){return d(),c("div",C,[s("div",{class:"flex items-center cursor-pointer",onClick:t[0]||(t[0]=(...e)=>a.toggleBooks&&a.toggleBooks(...e))},[s("div",S,[s("h3",T,u(i.user.name),1),s("p",U," Số sách mượn: "+u(i.user.borrowedBooks.length),1)]),s("div",{class:b([a.statusClass,"w-4 h-4 rounded-full"])},null,2)]),l.showBooks?(d(),c("div",j,[(d(!0),c(w,null,k(i.user.borrowedBooks,e=>(d(),c("div",{key:e.id,class:"p-2 mb-2 bg-gray-100 rounded"},[s("div",F,[s("img",{src:e.cover,alt:e.title,class:"object-cover w-16 h-16 mr-4 rounded"},null,8,N),s("div",O,[s("h4",H,u(e.title),1),s("p",R,u(e.author),1),s("p",A,[t[2]||(t[2]=s("strong",null,"Ngày mượn:",-1)),_(" "+u(e.borrowDate),1)]),s("p",V,[t[3]||(t[3]=s("strong",null,"Ngày đến hạn:",-1)),_(" "+u(e.returnDate),1)]),s("p",E,[t[4]||(t[4]=s("strong",null,"Trạng thái:",-1)),_(" "+u(e.status==="IB"?"Chưa trả":"Đã trả"),1)])]),e.status==="IB"?(d(),c("div",L,[s("button",{onClick:h=>a.confirmReturned(e.id),class:"p-2 text-white bg-green-500 rounded"}," Xác nhận đã trả ",8,X)])):g("",!0)])]))),128)),s("div",$,[s("button",{onClick:t[1]||(t[1]=(...e)=>a.confirmAllReturned&&a.confirmAllReturned(...e)),class:"p-2 text-white bg-blue-500 rounded"}," Xác nhận đã trả toàn bộ ")])])):g("",!0)])}const x=p(I,[["render",q],["__scopeId","data-v-86ac69aa"]]),z={components:{BookSearch:y,UserBorrowInfo:x},data(){return{books:null,users:null,filteredBooks:[],filteredUsers:[],loading:!1}},async created(){try{const{data:o,pending:t,error:i}=await B("books",()=>fetch("/data/book.json").then(e=>e.json())),{data:n,pending:l,error2:a}=await B("users",()=>fetch("/data/users.json").then(e=>e.json()));this.loading=t||l,this.books=o,this.users=n,this.filteredBooks=this.books,this.filteredUsers=this.sortUsers(this.users)}catch(o){console.error("Error fetching data:",o)}},methods:{applyFilter(o){this.filteredBooks=this.books.filter(t=>t.title.includes(o.searchQuery)&&t.author.includes(o.publisher)&&(o.bookType==="all"||t.type===o.bookType)&&(o.edition===""||t.edition===o.edition))},sortUsers(o){const t=new Date().toISOString().split("T")[0];return o.sort((i,n)=>{const l=i.borrowedBooks.some(r=>r.returnDate<t&&r.status==="IB"),a=n.borrowedBooks.some(r=>r.returnDate<t&&r.status==="IB"),e=i.borrowedBooks.some(r=>r.returnDate>=t&&r.status==="IB"),h=n.borrowedBooks.some(r=>r.returnDate>=t&&r.status==="IB");return l&&!a?-1:!l&&a?1:e&&!h?-1:!e&&h?1:0})}}},G={key:1},M={class:"container mx-auto mt-6"};function Q(o,t,i,n,l,a){const e=D,h=y,r=x;return d(),c("div",null,[t[0]||(t[0]=s("h2",{class:"my-6 text-2xl font-bold text-center"},"Tìm sách",-1)),l.loading?(d(),f(e,{key:0})):(d(),c("div",G,[v(h,{onFilter:a.applyFilter},null,8,["onFilter"]),s("div",M,[(d(!0),c(w,null,k(l.filteredUsers,m=>(d(),f(r,{key:m.id,user:m},null,8,["user"]))),128))])]))])}const Y=p(z,[["render",Q],["__scopeId","data-v-b20d7386"]]);export{Y as default};
